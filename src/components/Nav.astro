---
import { Image } from "astro:assets";
import chat from "../assets/images/chat.png";
import code from "../assets/images/code.png";
import linkedin from "../assets/images/linkedin.png";
import pen from "../assets/images/pen.png";
import bulb from "../assets/images/bulb.png";
import colophon from "../assets/images/colophon.png";
import hike from "../assets/images/hike.png";
---

<nav
  class="bg-linear-to-t to-blue-600 from-(--color-bg-primary) h-screen lg:h-screen lg:flex lg:flex-col lg:justify-start lg:p-6 md:h-auto md:p-4 lg:relative lg:pl-2"
>
  <div
    class="text-(--color-text-inverse) text-2xl font-black mb-4 lg:mb-12 lg:z-10 ml-4"
  >
    Andrei Stoica
  </div>

  <div id="icons-container" class="flex space-x-4 items-center ml-4">
    <a
      href="https://github.com/andreicstoica/"
      class="icon-link"
      data-tooltip="GitHub"
      target="_blank"
    >
      <Image src={code} alt="GitHub" class="icon" format="webp" />
      <span class="icon-label">GitHub</span>
    </a>
    <a href="/canon" class="icon-link" data-tooltip="Canon">
      <Image src={bulb} alt="Canon" class="icon" format="webp" />
      <span class="icon-label">Canon</span>
    </a>
    <a
      href="https://www.linkedin.com/in/andrei-c-stoica/"
      class="icon-link"
      data-tooltip="LinkedIn"
      target="_blank"
    >
      <Image src={linkedin} alt="LinkedIn" class="icon" format="webp" />
      <span class="icon-label">LinkedIn</span>
    </a>
    <a
      href="https://andreisthoughts.substack.com/"
      class="icon-link"
      data-tooltip="Blog"
      target="_blank"
    >
      <Image src={pen} alt="Blog" class="icon" format="webp" />
      <span class="icon-label">Blog</span>
    </a>
    <a
      href="https://x.com/andreistoica_"
      class="icon-link"
      data-tooltip="X"
      target="_blank"
    >
      <Image src={chat} alt="X" class="icon" format="webp" />
      <span class="icon-label">X</span>
    </a>
    <a href="/colophon" class="icon-link" data-tooltip="Colophon">
      <Image src={colophon} alt="Colophon" class="icon" format="webp" />
      <span class="icon-label">Colophon</span>
    </a>
    <a href="/fitness" class="icon-link" data-tooltip="Fitness">
      <Image src={hike} alt="Fitness" class="icon" format="webp" />
      <span class="icon-label">Fitness</span>
    </a>
  </div>

  <style>
    .icon {
      width: 32px;
      height: 32px;
    }

    .icon-link {
      display: flex;
      align-items: center;
      gap: 4px;
      text-decoration: none;
      color: inherit;
      transition: all 0.3s ease;
    }

    .icon-label {
      color: var(--color-text);
      font-size: 12px;
      font-weight: 500;
      opacity: 0.9;
      white-space: nowrap;
    }

    .icon-link:hover .icon,
    .icon-link:hover .icon-label {
      opacity: 1;
    }

    /* Tooltip styles */
    .icon-link::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: -30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
      z-index: 20;
    }

    .icon-link:hover::after {
      opacity: 1;
    }

    /* Large screens - random positioning */
    @media (min-width: 1024px) {
      .icon-link {
        position: absolute;
        flex-direction: column;
        align-items: center;
        gap: 2px;
        text-align: center;
      }

      .icon-label {
        font-size: 12px;
      }

      #icons-container {
        position: absolute;
        inset: 0;
        top: 5rem;
      }

      /* Hide tooltips on large screens since labels are visible */
      .icon-link::after {
        display: none;
      }
    }

    /* Medium screens - horizontal layout */
    @media (min-width: 768px) and (max-width: 1023px) {
      #icons-container {
        flex-wrap: wrap;
        gap: 1rem;
      }
    }

    /* Mobile styles */
    @media (max-width: 767px) {
      nav {
        height: auto !important;
        display: flex;
        flex-direction: column;
        padding: 1rem;
        position: relative;
      }

      .icon {
        width: 24px;
        height: 24px;
      }

      .icon-link {
        position: static !important;
        left: auto !important;
        top: auto !important;
        flex-shrink: 1;
        min-width: 0;
      }

      #icons-container {
        display: flex !important;
        flex-direction: row;
        gap: 0.5rem;
        position: static !important;
        inset: auto !important;
        top: auto !important;
        flex-wrap: nowrap;
        overflow-x: auto;
        padding-right: 1rem;
      }

      .icon-label {
        display: none;
      }

      .icon-link::after {
        display: none;
      }
    }
  </style>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const container = document.getElementById("icons-container");
      if (!container || window.innerWidth < 1024) return;

      const icons = Array.from(container.children) as HTMLElement[];
      const nav = container.closest("nav")!;

      const containerHeight = nav.clientHeight - 120;
      const containerWidth = nav.clientWidth - 80;
      const iconSize = 32;
      const totalItemHeight = 60; // icon + label + gap
      const minDistance = 80;

      const placedPositions: { x: number; y: number }[] = [];

      const isTooClose = (x: number, y: number) =>
        placedPositions.some((pos) => {
          const distance = Math.sqrt(
            Math.pow(x - pos.x, 2) + Math.pow(y - pos.y, 2)
          );
          return distance < minDistance;
        });

      icons.forEach((icon, i) => {
        const bandHeight = containerHeight / icons.length;
        const yMin = i * bandHeight;
        const yMax = (i + 1) * bandHeight - totalItemHeight;

        let position = null;
        let attempts = 0;

        while (attempts < 100) {
          const x = Math.random() * (containerWidth - iconSize);
          const y = yMin + Math.random() * Math.max(0, yMax - yMin);

          if (!isTooClose(x + iconSize / 2, y + totalItemHeight / 2)) {
            position = { x, y };
            break;
          }
          attempts++;
        }

        // Fallback position
        if (!position) {
          position = {
            x: Math.random() * (containerWidth - iconSize),
            y: yMin + Math.random() * Math.max(0, yMax - yMin),
          };
        }

        icon.style.left = `${position.x}px`;
        icon.style.top = `${position.y}px`;

        placedPositions.push({
          x: position.x + iconSize / 2,
          y: position.y + totalItemHeight / 2,
        });
      });
    });
  </script>
</nav>
