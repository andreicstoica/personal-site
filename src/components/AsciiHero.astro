---
import { personalStatement } from "../../lib/experience";
---

<section
  class="relative w-full min-h-[45vh] overflow-hidden flex items-center justify-center"
  style="background-color: var(--color-bg-primary);"
>
  <div
    class="absolute inset-0 flex items-center justify-center overflow-hidden"
  >
    <div
      id="ascii-output"
      class="font-mono text-xs leading-none tracking-wider m-0 p-0 overflow-hidden filter drop-shadow-sm ascii-display"
      style="background-color: var(--color-bg-primary);"
    >
      Loading ASCII...
    </div>
  </div>
  <div class="absolute top-4 left-4 z-10 lg:max-w-2xl">
    <p
      class="text-base text-(--color-text-primary) lg:text-md md:text-sm sm:text-sm font-normal leading-relaxed"
    >
      {personalStatement}
    </p>
  </div>
</section>

<style>
  .ascii-display {
    font-size: clamp(0.3rem, 0.6vw, 0.5rem);
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-ascii-bright);
    text-shadow:
      0 0 4px currentColor,
      0 0 8px currentColor,
      0 0 12px rgba(56, 72, 255, 0.3);
    white-space: pre-wrap;
    line-height: 0.8;
    text-align: center;
    animation: ascii-glow 3s ease-in-out infinite alternate;
    overflow: hidden;
    font-family: monospace;
  }

  @keyframes ascii-glow {
    0% {
      filter: brightness(1) contrast(1);
    }
    100% {
      filter: brightness(1.2) contrast(1.1);
    }
  }

  @media (max-width: 768px) {
    .ascii-display {
      font-size: 0.35rem;
      letter-spacing: 0.02em;
    }
  }

  @media (prefers-color-scheme: dark) {
    .ascii-display {
      color: var(--color-ascii-bright);
      text-shadow:
        0 0 6px currentColor,
        0 0 12px currentColor,
        0 0 18px rgba(90, 106, 255, 0.4);
    }
  }
</style>

<script>
  import { AsciiVideoConverter } from "../../lib/asciiVideo";

  const output = document.getElementById("ascii-output") as HTMLDivElement;
  let converter: AsciiVideoConverter | null = null;

  // Initialize ASCII video converter
  async function initAsciiVideo() {
    try {
      console.log("ðŸŽ¬ Initializing ASCII video...");
      converter = new AsciiVideoConverter("/videos/ascii-bg.mp4", output);
      await converter.start();
      console.log("ðŸŽ¬ ASCII video started successfully");
    } catch (error) {
      console.error("Failed to initialize ASCII video:", error);
      // Show fallback message
      output.innerHTML = "ASCII Video Error - Check Console";
    }
  }

  // Start the ASCII video when the page loads
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initAsciiVideo);
  } else {
    initAsciiVideo();
  }

  // Cleanup on page unload
  window.addEventListener("beforeunload", () => {
    if (converter) {
      converter.destroy();
    }
  });

  // Handle visibility changes for performance
  document.addEventListener("visibilitychange", () => {
    if (converter) {
      if (document.hidden) {
        converter.stop();
      } else {
        converter.start();
      }
    }
  });
</script>
