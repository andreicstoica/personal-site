---
import { marked } from "marked";
import {
  replaceProjectReferencesWithHTML,
  getReferencedProjects,
} from "../../lib/projectParser";

interface Props {
  description: string;
}

const { description } = Astro.props;

// Process the description to replace project references
const processedDescription = replaceProjectReferencesWithHTML(description);

// Set up markdown renderer
const renderer = new marked.Renderer();
renderer.link = function ({ href, title, text }) {
  return `<a href="${href}" target="_blank" rel="noopener noreferrer"${title ? ` title="${title}"` : ""}>${text}</a>`;
};
marked.setOptions({ renderer });

// Convert processed description to HTML
const htmlContent = marked(processedDescription);
---

<div class="project-enhanced-description">
  <div class="prose prose-sm max-w-none text-pretty pr-1.5 text-sm">
    <div set:html={htmlContent} />
  </div>
</div>

<style>
  /* Project link hover effects */
  .project-enhanced-description .project-link:hover {
    color: #707fff;
    text-decoration-style: solid;
    text-decoration-thickness: 2px;
  }

  .project-link:focus:not(:focus-visible) {
    outline: none;
  }

  /* Speed highlight styling */
  .project-enhanced-description :global(.speed-highlight) {
    text-decoration: underline;
    text-decoration-color: var(--color-warning);
    text-decoration-style: dashed;
    text-underline-offset: 3px;
  }
</style>
